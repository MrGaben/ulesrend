<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sulfrulic acid</title>
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    
    <link rel="stylesheet" href="diak_tanterem-style.css">
    <script src="filesaver.js"></script>
</head>
<body>


    <div class="lines">
        <div class="line"></div>
        <div class="line"></div>
<br><br>
        
            <p class="biglist" style="text-align: left; font-size:50px; font-style:bold; color:black 70% ;margin-left:20px">Diákok</p>
            <br>
            <p id="classInputDescription" style="margin-left:20px">Válassza ki a diákok csoportnevét a listából</p>
            <input type="text" id="kivalaszt" list="osztalyok/csop" style="float:left; color:black; ;margin-left:20px" placeholder="Adjon meg egy osztályt" onchange="AddValue(document.getElementById('osztalyok/csop').value, document.getElementById('osztalyok/csop').text), osztalyok()" >
            <datalist name="osztalyok/csop" id="osztalyok/csop" style="float:left; color:black; ;margin-left:20px" placeholder="sfafs">
                <!--<option value="osztaly_13/a">13/a. osztály</option>
                <option value="osztaly_13/b">13/b. osztály</option>-->
                <option value="13CC">13CC</option>
                <option value="13E_CC">13E_CC</option>
                <option value="13IR">13IR</option>
                <option value="13R">13R</option>
                <option value="13TT">13TT</option>
                <!--<option value="osztaly_12/a">12/a. osztály</option>
                <option value="osztaly_12/b">12/b. osztály</option>-->
                <option value="12SZF1">12SZF1</option>
                <option value="12SZF2">12SZF2</option>
                <option value="12IRU">12IRU</option>
                <option value="12IPI">12IPI</option>
                <option value="12EE">12EE</option>
                <!--<option value="osztaly_11/a">11/a. osztály</option>
                <option value="osztaly_11/b">11/b. osztály</option>-->
                <option value="11Szf1">11SZF1</option>
                <option value="11Szf2">11SZF2</option>
                <option value="11IRU">11IRU</option>
                <option value="11IPI">11IPI</option>
                <option value="11EE">11EE</option>
               <!-- <option value="osztaly_10/a">10/a. osztály</option>
                <option value="osztaly_10/b">10/b. osztály</option>-->
                <option value="10ISZ1">10ISZ1</option>
                <option value="10ISZ2">10ISZ2</option>
                <option value="10ISZ3">10ISZ3</option>
                <option value="10ESZ1">10ESZ1</option>
                <option value="10ESZ2">10ISZ2</option>
                <option value="10E">10E</option>
                <option value="10Ainf1">10AINF1</option>
                <option value="10Ainf2">10AINF2</option>
                <option value="10BInf1">10INF1</option>
                <option value="10BInf2">10INF2</option>
                <!--<option value="osztaly_9/a">9/a. osztály</option>
                <option value="osztaly_9/b">9/b. osztály</option>-->
                <option value="9ISZ1">9ISZ1</option>
                <option value="9ISZ2">9ISZ2</option>
                <option value="9ISZ3">9ISZ3</option>
                <option value="9I1">9I1</option>
                <option value="9I2">9I2</option>
                <option value="9ESZ1">9ESZ1</option>
                <option value="9ESZ2">9ESZ2</option>
                <option value="9E">9E</option>
                <option value="9Ainf1">9AINF1</option>
                <option value="9Ainf2">9AINF2</option>
                <option value="9BInf1">9INF1</option>
                <option value="9BInf2">9INF2</option>
            </datalist>
            <!--<button type="button" onclick="AddValue(document.getElementById('osztalyok/csop').value, document.getElementById('osztalyok/csop').text), osztalyok()">osztaly kiválasztása</button>
            -->

         <!--   <select name="osztalyok/csop" id="osztalyok/csop" style="float:left;" onchange="osztalyok()">

            </select>
-->
            <br><br><br><br>
            <div id="left" style="margin-right: 150am; display:flex;">

            </div>
            <br><br><br>
            <p class="biglist" style="text-align: left; font-size:50px; font-style:bold; ;margin-left:20px">Tanterem</p>
            <br>
            <p id="roomInputDescription" style="margin-left:20px">Válassza ki a megfelelő termet!</p>
            <p class="" style="margin-left:20px">Betöltés esetén válassza ki a betöltenő termet először és aztán válassza ki a betölteni kívánt fájlt!</p>
            <input type="text" id="newkivalaszt"list="termek" style="float:left; color:black; ;margin-left:20px " placeholder="Válasszon ki egy termet" onchange="AddValue2(document.getElementById('termek').value, document.getElementById('termek').text), teremgen()">
            <datalist name="termek" id="termek" style="float:left; ;margin-left:20px" >
                <option value="SZT1">SZT1</option>
                <option value="SZT2">SZT2</option>
                <option value="SZT3">SZT3</option>
                <option value="SZT4">SZT4</option>
                <option value="SZT5">SZT5</option>
                <option value="SZT6">SZT6</option>
                <option value="SZT7">SZT7</option>
                <option value="terem_1">1. terem</option>
                <option value="terem_2">2. terem</option>
                <option value="terem_3">3. terem</option>
                <option value="terem_4">4. terem</option>
                <option value="terem_5">5. terem</option>
                <option value="terem_6">6. terem</option>
                <option value="terem_7">7. terem</option>
                <option value="terem_8">8. terem</option>
                <option value="terem_9">9. terem</option>
                <option value="terem_10">10. terem</option>
                <option value="matek_1">Matek 1</option>
                <option value="matek_3">Matek 3</option>
                <option value="nyelvi_lab">Nyelvi Labor</option>

            </datalist>
            <select name="har" id="har" onchange="AddValue2(document.getElementById('har').value, document.getElementById('har').text), teremgen()" hidden>
                <option value="nem">nem</option>
            </select>
            <!--<button type="button" onclick="AddValue2(document.getElementById('termek').value, document.getElementById('termek').text), teremgen()">terem kiválasztása</button>
            --><br>
                <!-- Select options here -->
            </select>
            <br>    
            <div class="line"></div>
            <div id="content"></div>
            <br>
            <br>
            <br>

            

            <button id="saveButton" type="button" class="btn btn-outline-dark btn-light">Mentés</button>
            <button id="loadButton" type="button" class="btn btn-outline-dark btn-light">Betöltés</button>
                          

    <script>
        function handleInputChange() {
            AddValue(document.getElementById('kivalaszt').value, document.getElementById('kivalaszt').text);
            osztalyok();
        }

        
        function AddValue(){
            const Value = document.querySelector('#kivalaszt').value;
          
            if(!Value) return;
          

            let input = document.getElementById("kivalaszt");
            let p = document.getElementById("classInputDescription");
           // input.setAttribute("hidden","hidden");
            p.setAttribute("hidden","hidden");
            const har = Value;
            

          

            return har;
          }
          function AddValue2(){
            const Value = document.querySelector('#newkivalaszt').value;
          
            if(Value == null) {const Value = document.getElementById("har");};
          
            let input = document.getElementById("newkivalaszt");
            let p = document.getElementById("roomInputDescription");
           // input.setAttribute("hidden","hidden");
            p.setAttribute("hidden","hidden");
            const har1 = Value;
            

            return har1;
          }
          let ulesszam = 0;
        function teremgen(a){
        $(function newfile(){
            let b = AddValue2()
            if(b == ""){
            $.ajax({
                
                url: a+".csv", 
                async: false,   
                cache: false,   
                dataType: "text",  
                success: function( data, textStatus, jqXHR ) {
                    var resourceContent = data;
                    var preText = resourceContent;
                    var preTextArray = preText.split(';');

                    let hely = 1;

                    for (let i = 0; i < preTextArray.length; i++) {
                        if (preTextArray[i].trim() === "0") {
                            contentDiv = document.getElementById("content");
                            var newDiv = document.createElement("div");
                          //  newDiv.textContent = " ";
                            newDiv.setAttribute("id","_"+hely);
                            
                            newDiv.classList.add("right");
                            hely++;
                            ulesszam++;
                            contentDiv.appendChild(newDiv);
                        } else if (preTextArray[i].trim() === "1") {

                            var newDiv = document.createElement("br");

                            contentDiv.appendChild(newDiv);
                        }
                        else if (preTextArray[i].trim() === "null") {
                            contentDiv = document.getElementById("content");
                            var newDiv = document.createElement("div");
                            newDiv.style.padding = "30px";
                            newDiv.style.display = "inline-block";
                            newDiv.style.margin = "10px";

                            contentDiv.appendChild(newDiv);
                        }
                        else if (preTextArray[i].trim() === "2")
                        {
                            contentDiv = document.getElementById("content");
                            var newDiv = document.createElement("div");
                            newDiv.style.backgroundColor = "#0c0d13";
                            newDiv.style.display = "inline-block";  
                            newDiv.style.margin = "15px";
                            newDiv.style.paddingTop = "20px";
                            newDiv.style.visibility = "hidden";
                            newDiv.style.position = "relative";
                            newDiv.style.maxHeight = "300px";  
                            newDiv.style.paddingLeft = "40px"; 
                            newDiv.style.paddingBottom = "20px";
                            newDiv.style.paddingRight = "40px";
                            newDiv.classList.add("right");
                            contentDiv.appendChild(newDiv);
                        }
                        runScriptAgain();
                    }
                }

            }
        );
            }
            else{
                a = AddValue2();
            $.ajax({
                
                url: a+".csv", 
                async: false,   
                cache: false,   
                dataType: "text",  
                success: function( data, textStatus, jqXHR ) {
                    var resourceContent = data;
                    var preText = resourceContent;
                    var preTextArray = preText.split(';');

                    let hely = 1;

                    for (let i = 0; i < preTextArray.length; i++) {
                        if (preTextArray[i].trim() === "0") {
                            contentDiv = document.getElementById("content");
                            var newDiv = document.createElement("div");
                          //  newDiv.textContent = " ";
                            newDiv.setAttribute("id","_"+hely);
                            
                            newDiv.classList.add("right");
                            hely++;
                            ulesszam++;
                            contentDiv.appendChild(newDiv);
                        } else if (preTextArray[i].trim() === "1") {

                            var newDiv = document.createElement("br");

                            contentDiv.appendChild(newDiv);
                        }
                        else if (preTextArray[i].trim() === "null") {
                            contentDiv = document.getElementById("content");
                            var newDiv = document.createElement("div");
                            newDiv.style.padding = "30px";
                            newDiv.style.display = "inline-block";
                            newDiv.style.margin = "10px";

                            contentDiv.appendChild(newDiv);
                        }
                        else if (preTextArray[i].trim() === "2")
                        {
                            contentDiv = document.getElementById("content");
                            var newDiv = document.createElement("div");
                            newDiv.style.backgroundColor = "#0c0d13";
                            newDiv.style.display = "inline-block";  
                            newDiv.style.margin = "15px";
                            newDiv.style.paddingTop = "20px";
                            newDiv.style.visibility = "hidden";
                            newDiv.style.position = "relative";
                            newDiv.style.maxHeight = "300px";  
                            newDiv.style.paddingLeft = "40px"; 
                            newDiv.style.paddingBottom = "20px";
                            newDiv.style.paddingRight = "40px";
                            newDiv.classList.add("right");
                            contentDiv.appendChild(newDiv);
                        }
                        runScriptAgain();
                    }
                }

            }
        );
            }
            }
        ,)}
        function osztalyok(){
            $(function newfile(){
                let osztaly = AddValue()
                $('#left').empty();
                if(osztaly != null){
                    osztaly = AddValue()
                $.ajax({
                    
                    url: osztaly+".csv", 
                    async: false,   
                    cache: false,   
                    dataType: "text",  
                    success: function( data, textStatus, jqXHR ) {
                        var resourceContent = data;
                        var preText = resourceContent;
                        var preTextArray = preText.split(';');
                        let tor = 5;
                        let newdiv = 0;
                        for (let i = 0; i < preTextArray.length; i++) {
                            if (preTextArray[i].trim() != "") {
                                har = document.getElementById("left");
                                if(tor == 5)
                                {
                                    newdiv++;
                                    var sortor = document.createElement("div");
                                    sortor.style.display = "inline-block";
                                    sortor.style.width = "300px";
                                 //   sortor.style.height = "120px";
                                    sortor.setAttribute("id", "left" +newdiv);
                                    sortor.style.border = "white dotted 2px";
                                    sortor.style.padding = "30px";
                                    sortor.style.borderRadius = "8px";
                                    sortor.style.background = "hsla(0, 0%, 46%, 0.8)";
                                    tor = 0;
                                    
                                    har.appendChild(sortor);
                                }

                                nev = document.getElementById("left" +newdiv)
                                var newli = document.createElement("p");
                                newli.classList.add("list");
                                newli.setAttribute("draggable", "true");
                                //newli.style.position = "absolute";
                             //   newli.style.paddingLeft = "0px";
                                newli.style.textAlign = "center";
                                newli.style.overflow = "hidden"
                               // newli.style.marginRight = "700px";
                                newli.style.width = "auto";
                                newli.textContent = preTextArray[i];
                          //      var br = document.createElement("br");
                                tor++;
                                nev.appendChild(newli);
                             //   nev.appendChild(br);
                            }
                        }
                        runScriptAgain();
                    }
    
                }
            );
                }
            });
            };


        function handleFileInput(input) {
            const descriptionId = input.id === "fileInput1" ? "classInputDescription" : "roomInputDescription";
            const description = document.getElementById(descriptionId);
            
            if (input.files.length > 0) {
                input.style.display = "none";
                description.style.display = "none";
            }
        }
        

let rightBoxes;
let p = document.getElementById("lists");
let divContains_P = document.getElementById('left').contains(p);

function runScriptAgain() {
    let lists = document.getElementsByClassName("list");
    let leftBox = document.getElementById("left");
    rightBoxes = document.getElementsByClassName("right");

    for (let i = 0; i < rightBoxes.length; i++) {
        const savedData = localStorage.getItem("rightBox_" + i);
        if (savedData) {
            rightBoxes[i].innerHTML = savedData;
        }
    }

    for (list of lists) {
        list.addEventListener("dragstart", function (e) {
            let selected = e.target;
            for (rightBox of rightBoxes) {
                rightBox.addEventListener("dragover", function (e) {
                    e.preventDefault();
                });
                rightBox.addEventListener("drop", function (e) {
                    if (this.childElementCount === 0) {
                        this.appendChild(selected);
                    }
                    selected = null;
                });
            }

            leftBox.addEventListener("dragover", function (e) {
                e.preventDefault();
            });
            leftBox.addEventListener("drop", function (e) {
                if (this.childElementCount === 0) {
                    this.appendChild(selected);
                }
                selected = null;
            });
        });

    }
}


const saveButton = document.getElementById("saveButton");
const loadButton = document.getElementById("loadButton");
let emptyP = document.getElementById("left");

saveButton.addEventListener("click", function () {
    const rightBoxes = document.getElementsByClassName("right");
    const dataToSave = [];

    for (let i = 0; i < rightBoxes.length; i++) {
        const studentList = Array.from(rightBoxes[i].getElementsByClassName("list"));
        const studentData = studentList.map(student => {
            return {
                name: student.textContent,
                
            };
        });
        dataToSave.push(studentData);
    }

    const jsonString = JSON.stringify(dataToSave);
    const blob = new Blob([jsonString], { type: "application/csv" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");

    const csoportnev = AddValue();
    const teremnev = AddValue2();
    a.download = csoportnev + "_" + teremnev + ".csv";

    document.body.appendChild(a);
    a.href = url;
    a.click();
    saveAs(blob, a.download)
    document.body.removeChild(a);
    URL.revokeObjectURL(url);



});
(function(Element, undefined){
    var _setAttribute = Element.prototype.setAttribute;
 
    Element.prototype.setAttribute = function(attrName, attrValue){
        if (this.hasAttribute(attrName)) {
            if (attrValue !== undefined) {
                _setAttribute.call(this, attrName, attrValue);
            }
            //do nothing if attr exists and action is to create
        }
        else {
            _setAttribute.call(this, attrName, (attrValue === undefined ? '' : attrValue));
        }
    }
})(Element);
var sleepSetTimeout_ctrl;

function sleep(ms) {
    clearInterval(sleepSetTimeout_ctrl);
    return new Promise(resolve => sleepSetTimeout_ctrl = setTimeout(resolve, ms));
}
loadButton.addEventListener("click", function () {
    const fileInput = document.createElement("input");
    fileInput.type = "file";
    fileInput.accept = ".csv";
    fileInput.addEventListener("change", function () {
        const file = fileInput.files[0];
        let har = file.name;
        let what = har.split('_');
        what = what[1].split('.');
        if (what[0].includes('('))
        {
            console.log(what = what[0].split(' '));
            console.log("fasz");
        }
        what = what[0]
        let teremhely = document.getElementById("har");
        let optionGen = document.createElement("option");
        optionGen.value = what;
        optionGen.selected = true;
        teremhely.appendChild(optionGen); 
        teremgen(what);  
        $(document).ready(function(){
            setTimeout(function(){
                hellyeah()
            },500);
            });
            function hellyeah(){
        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                const jsonString = e.target.result;
                const dataToLoad = JSON.parse(jsonString);

                for (let i = 0; i < rightBoxes.length; i++) {
                    const studentData = dataToLoad[i];
                    if (studentData) {
                        const rightBox = rightBoxes[i];
                        rightBox.innerHTML = ""; 

                        studentData.forEach(student => {
                            const newLi = document.createElement("p");
                            newLi.classList.add("list");
                            newLi.textContent = student.name;
                            newLi.style.textAlign = "center";
                            newLi.style.overflow = "hidden";
                            newLi.setAttribute("draggable", "true");
                            rightBox.appendChild(newLi);
                        });
                    }
                }

                runScriptAgain();
            };
            reader.readAsText(file);
        }
    }});
    
    fileInput.click();
    
});

            
    </script>
</body>
</html>